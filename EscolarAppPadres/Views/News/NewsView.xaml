<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="EscolarAppPadres.Views.News.NewsView"
             Title="NOTICIAS">

    <AbsoluteLayout>
        <Grid AbsoluteLayout.LayoutFlags="All"
              AbsoluteLayout.LayoutBounds="0,0,1,1"
              Margin="5">
            <RefreshView IsRefreshing="{Binding IsRefreshing}" Command="{Binding LoadNewsCommand}">

                <CollectionView ItemsSource="{Binding Noticias}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame CornerRadius="10" 
                                   Padding="10" 
                                   HasShadow="True" 
                                   BackgroundColor="White"
                                   BorderColor="LightGray"
                                   Margin="10">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type CollectionView}}, Path=BindingContext.OpenBondNewsCommand}" 
                                                          CommandParameter="{Binding .}" />
                                </Frame.GestureRecognizers>

                                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="10" ColumnDefinitions="*,*">

                                    <Frame Grid.Row="0"
                                           Grid.ColumnSpan="2"
                                           CornerRadius="10"
                                           HasShadow="True"
                                           BackgroundColor="White"
                                           BorderColor="LightGray">
                                        <Grid ColumnDefinitions="*,*">
                                            <Image Grid.Row="0"
                                                   Grid.ColumnSpan="2"
                                                   Source="{Binding Notificacion.NotificacionImageFormato}"
                                                   Aspect="AspectFit"
                                                   HeightRequest="170" />

                                            <Image Grid.Row="0"
                                                   Grid.ColumnSpan="2"
                                                   Source="{Binding EstadoImagen}" 
                                                   HeightRequest="40" 
                                                   WidthRequest="40" 
                                                   HorizontalOptions="End" 
                                                   VerticalOptions="Start" />
                                        </Grid>
                                    </Frame>

                                    <Label Grid.Row="1" 
                                           Grid.ColumnSpan="2"
                                           Text="{Binding Notificacion.Titulo}"
                                           FontSize="24"
                                           FontAttributes="Bold"
                                           TextColor="Black"
                                           HorizontalOptions="Center" />

                                    <Label Grid.Row="2" 
                                           Grid.ColumnSpan="2"
                                           Text="{Binding Notificacion.FechaHora}"
                                           FontSize="15"
                                           TextColor="Black"
                                           HorizontalOptions="Center" />

                                    <Label Grid.Row="3" 
                                           Grid.ColumnSpan="2"
                                           Text="{Binding Notificacion.Mensaje}"
                                           FontSize="15"
                                           TextColor="Black"
                                           HorizontalOptions="Center" />

                                    <Button Grid.Row="4"
                                            Grid.Column="0"
                                            CornerRadius="20"
                                            Text="RECORDAR" 
                                            BackgroundColor="{StaticResource StaticButtonColorDarkGray}" 
                                            TextColor="White"
                                            WidthRequest="150"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.OpenFilterCalendarReminderCommand}"
                                            CommandParameter="{Binding .}"/>

                                    <Button Grid.Row="4"
                                            Grid.Column="1"
                                            CornerRadius="20"
                                            Text="{Binding TextoLeido}" 
                                            BackgroundColor="{StaticResource StaticBackgroundColorGreen}" 
                                            TextColor="White"
                                            WidthRequest="150"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SendReadNewsCommand}"
                                            CommandParameter="{Binding .}" />
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>
            <Label Text="No se encontraron noticias."
                   TextColor="Black"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   FontSize="18"
                   FontAttributes="Bold"
                   Margin="10"
                   IsVisible="{Binding SinResultados}"/>
        </Grid>

        <Button x:Name="Filtros" 
                FontSize="18"
                TextColor="Black"
                CornerRadius="20"
                BackgroundColor="{StaticResource StaticBackgroundColorGreen}"
                AbsoluteLayout.LayoutFlags="PositionProportional"
                AbsoluteLayout.LayoutBounds="1,1,AutoSize,AutoSize"
                Margin="10" 
                HeightRequest="65"
                WidthRequest="65"
                Command="{Binding OpenFilterPopupNewsCommand}">
            <Button.ImageSource>
                <FileImageSource File="filter_outline.svg" />
            </Button.ImageSource>
        </Button>
    </AbsoluteLayout>
</ContentPage>