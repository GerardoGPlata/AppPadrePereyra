<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:syncfusionPopup="clr-namespace:Syncfusion.Maui.Popup;assembly=Syncfusion.Maui.Popup"
             xmlns:controls="clr-namespace:EscolarAppPadres.Controls;assembly=EscolarAppPadres"
             x:Class="EscolarAppPadres.Views.School.ConductualView"
             Title="ESCOLAR"
             BackgroundColor="#f5f8fa"
             Padding="{OnPlatform iOS='0,20,0,0', Android='0'}">

    <Grid>
        <!-- Refrescar lista -->
        <RefreshView Command="{Binding LoadReportsCommand}"
                     IsRefreshing="{Binding IsRefreshing}">
            <ScrollView>
                <StackLayout Padding="15"
                             Spacing="15"
                             Margin="0,0,0,60">
                    <!-- Mensaje si no hay datos -->
                    <Label Text="No se encontraron reportes"
                           FontSize="16"
                           TextColor="Gray"
                           HorizontalOptions="Center"
                           IsVisible="{Binding SinResultados}"/>

                    <!-- Lista de reportes -->
                    <CollectionView ItemsSource="{Binding Reports}"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="White"
                                       CornerRadius="16"
                                       HasShadow="True"
                                       Margin="0,10"
                                       Padding="20">
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer
                                            Command="{Binding Source={x:Reference collectionView}, Path=BindingContext.ReportTappedCommand}"
                                            CommandParameter="{Binding .}"/>
                                    </Frame.GestureRecognizers>

                                    <Grid ColumnDefinitions="*,Auto"
                                          RowDefinitions="Auto,Auto">
                                        <Label Text="{Binding FechaRegistro, StringFormat='Fecha: {0:dd/MM/yyyy}'}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="#273840"
                                               Grid.Row="0"
                                               Grid.Column="0"/>

                                        <Label Text="{Binding Observaciones}"
                                               FontSize="14"
                                               TextColor="Gray"
                                               Grid.Row="1"
                                               Grid.Column="0"/>

                                        <Image Source="chevron_right"
                                               WidthRequest="18"
                                               HeightRequest="18"
                                               HorizontalOptions="End"
                                               VerticalOptions="Center"
                                               Grid.RowSpan="2"
                                               Grid.Column="1"
                                               Margin="8,0,0,0"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </ScrollView>
        </RefreshView>

        <!-- Selector de hijo -->
        <Frame BackgroundColor="#008347"
               CornerRadius="20"
               HasShadow="True"
               Padding="6,2"
               Margin="0,0,0,25"
               HeightRequest="44"
               WidthRequest="280"
               HorizontalOptions="Center"
               VerticalOptions="End">
            <Grid ColumnDefinitions="*,Auto"
                  VerticalOptions="Center"
                  HeightRequest="32">
                <controls:ChildPicker Title="Seleccionar hijo"
                                      ItemsSource="{Binding Hijos}"
                                      ItemDisplayBinding="{Binding NombreCompleto}"
                                      SelectedItem="{Binding SelectedHijo}"
                                      FontSize="11.7"
                                      FontAttributes="Bold"
                                      TextColor="White"
                                      TitleColor="White"
                                      HorizontalOptions="Fill"
                                      Margin="0,0,4,0"/>
                <Image Source="chevron_down_white"
                       Grid.Column="1"
                       WidthRequest="18"
                       HeightRequest="18"
                       VerticalOptions="Center"
                       HorizontalOptions="End"
                       Margin="4,0,4,0"/>
            </Grid>
        </Frame>

        <!-- Popup -->
        <syncfusionPopup:SfPopup x:Name="sfPopup"
                                 StaysOpen="True"
                                 OverlayMode="Blur"
                                 ShowCloseButton="True"
                                 IsOpen="False"
                                 AutoSizeMode="Height"
                                 AnimationMode="Fade"
                                 WidthRequest="312"
                                 HeightRequest="250"
                                 HeaderHeight="70"
                                 HeaderTitle="Reporte">
            <syncfusionPopup:SfPopup.PopupStyle>
                <syncfusionPopup:PopupStyle HeaderBackground="#273840"
                                            HeaderFontSize="14"
                                            HeaderTextColor="White"
                                            PopupBackground="White"
                                            BlurIntensity="Dark"/>
            </syncfusionPopup:SfPopup.PopupStyle>
            <syncfusionPopup:SfPopup.ContentTemplate>
                <DataTemplate>
                    <ScrollView Padding="10">
                        <Label Text="{Binding PopupContent}"
                               TextColor="#49454E"
                               FontSize="14"
                               LineBreakMode="WordWrap"/>
                    </ScrollView>
                </DataTemplate>
            </syncfusionPopup:SfPopup.ContentTemplate>
        </syncfusionPopup:SfPopup>
    </Grid>
</ContentPage>
